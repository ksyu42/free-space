<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>スペース管理</title>

    <link rel="stylesheet" th:href="@{/css/common.css}">
    <link rel="stylesheet" th:href="@{/css/admin.css}">
    <link rel="stylesheet" th:href="@{/css/admin_spaces.css}">

    <!-- 座席数操作用 JS -->
    <script th:src="@{/js/admin-seat.js}"></script>
</head>
<body>

    <!-- ナビ -->
    <div class="navigation">
        <div class="nav-left">&nbsp;</div>
        <div class="nav-right">
            <!-- 管理者ログアウト -->
            <a th:href="@{/admin/logout}" class="btn">ログアウト</a>
        </div>
    </div>

    <div class="title-bar">
        <h1>スペース管理</h1>
    </div>

    <div class="admin-area">

        <!--
            【修正点】
            新規作成は SpaceController: GET /admin/spaces/new
         -->
        <div class="top-actions">
            <a th:href="@{/admin/spaces/new}" class="add-btn">＋ 新規作成</a>
        </div>

        <table class="space-table">
            <thead>
                <tr>
                    <th>ID</th>
                    <th>スペース名</th>
                    <th>場所</th>
                    <th>開始</th>
                    <th>終了</th>
                    <th>座席数（時間帯ごと）</th>
                    <th>削除</th>
                </tr>
            </thead>

            <tbody>
                <tr th:each="space : ${spaceList}">
                    <td th:text="${space.id}"></td>
                    <td th:text="${space.name}"></td>
                    <td th:text="${space.location}"></td>
                    <td th:text="${space.availableFrom}"></td>
                    <td th:text="${space.availableTo}"></td>

                    <!-- 座席数（JSで + / - を叩く想定の既存仕様を維持） -->
                    <td>
                        <div th:each="ts : ${timeList}" class="seat-row">
                            <span th:text="${ts.time}"></span>

                            <button type="button"
                                    class="seat-btn minus"
                                    th:attr="data-space-id=${space.id},data-time-id=${ts.id}">
                                −
                            </button>

                            <span class="seat-count"
                                  th:attr="id=${'seat-' + space.id + '-' + ts.id}"
                                  th:text="${seatMap[space.id + '-' + ts.id]}">
                            </span>

                            <button type="button"
                                    class="seat-btn plus"
                                    th:attr="data-space-id=${space.id},data-time-id=${ts.id}">
                                ＋
                            </button>
                        </div>
                    </td>

                    <td>
                        <!--
                            【修正点】
                            削除は SpaceController: POST /admin/spaces/delete/{id}
                         -->
                        <form th:action="@{/admin/spaces/delete/{id}(id=${space.id})}"
                              method="post"
                              onsubmit="return confirm('このスペースを削除しますか？');">
                            <button type="submit" class="delete-btn">削除</button>
                        </form>
                    </td>
                </tr>
            </tbody>
        </table>

    </div>

</body>
</html>
